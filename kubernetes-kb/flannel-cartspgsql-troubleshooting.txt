13 May 2020, with Mitch

ERRORS IN CARTSPGSQL POD

requests.exceptions.ConnectionError: HTTPConnectionPool(host='t2258mws0001.stores.target.com', port=2379): Max retries exceeded with url: /v2/keys/service/cartspgsql/members/cartspgsql-1 (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f0aeffa3978>: Failed to establish a new connection: [Errno -3] Temporary failure in name resolution',))

TEST ETCD CONNECTIN INSIDE CARSPGSQL POD
Curl to etcd success only intermittently

# kubectl exec -ti cartspgsql-1

\# curl http://t2258mws0002.stores.target.com:2379/v2/keys/service/cartspgsql/members/cartspgsql-1
curl: (6) Could not resolve host: t2258mws0002.stores.target.com

\# curl http://t2258mws0002.stores.target.com:2379/v2/keys/service/cartspgsql/members/cartspgsql-1
{"action":"get","node":{"key":"/service/cartspgsql/members/cartspgsql-1","value":"{\"conn_url\":\"postgres://10.244.2.178:5432/postgres\",\"api_url\":\"http://10.244.2.178:8008/patroni\",\"state\":\"running\",\"role\":\"master\",\"xlog_location\":469611734224,\"timeline\":37}","expiration":"2020-05-13T03:44:35.735021557Z","ttl":25,"modifiedIndex":3678870,"createdIndex":3678870}}

LOGS OF FLANNEL CONTAINER
--> flannel is a pod - but get its container and docker logs of that

[root@t2258mws0002 ~]# docker logs 401a254204d0
I0207 22:54:03.473460       1 main.go:470] Determining IP address of default interface
I0207 22:54:03.473794       1 main.go:483] Using interface with name eth0 and address 10.140.42.134
I0207 22:54:03.473817       1 main.go:500] Defaulting external address to interface address (10.140.42.134)
I0207 22:54:03.497927       1 kube.go:130] Waiting 10m0s for node controller to sync
I0207 22:54:03.498002       1 kube.go:283] Starting kube subnet manager
I0207 22:54:04.500332       1 kube.go:137] Node controller sync successful
I0207 22:54:04.500387       1 main.go:235] Created subnet manager: Kubernetes Subnet Manager - t2258mws0002
I0207 22:54:04.500394       1 main.go:238] Installing signal handlers
I0207 22:54:04.500603       1 main.go:348] Found network config - Backend type: vxlan
I0207 22:54:04.500671       1 vxlan.go:119] VXLAN config: VNI=1 Port=0 GBP=false DirectRouting=false
I0207 22:54:04.500991       1 main.go:543] Start healthz server on 0.0.0.0:8285
I0207 22:54:04.538870       1 main.go:295] Wrote subnet file to /run/flannel/subnet.env
I0207 22:54:04.538955       1 main.go:299] Running backend.
I0207 22:54:04.539014       1 main.go:317] Waiting for all goroutines to exit
I0207 22:54:04.539077       1 vxlan_network.go:56] watching for new subnet leases
I0207 22:54:04.550695       1 ipmasq.go:75] Some iptables rules are missing; deleting and recreating rules
I0207 22:54:04.550755       1 ipmasq.go:97] Deleting iptables rule: -s 10.244.0.0/16 -d 10.244.0.0/16 -j RETURN
I0207 22:54:04.555485       1 ipmasq.go:97] Deleting iptables rule: -s 10.244.0.0/16 ! -d 224.0.0.0/4 -j MASQUERADE
I0207 22:54:04.563480       1 ipmasq.go:97] Deleting iptables rule: ! -s 10.244.0.0/16 -d 10.244.0.0/24 -j RETURN
I0207 22:54:04.570565       1 ipmasq.go:97] Deleting iptables rule: ! -s 10.244.0.0/16 -d 10.244.0.0/16 -j MASQUERADE
I0207 22:54:04.576367       1 ipmasq.go:85] Adding iptables rule: -s 10.244.0.0/16 -d 10.244.0.0/16 -j RETURN
I0207 22:54:04.597946       1 ipmasq.go:85] Adding iptables rule: -s 10.244.0.0/16 ! -d 224.0.0.0/4 -j MASQUERADE
I0207 22:54:04.615126       1 ipmasq.go:85] Adding iptables rule: ! -s 10.244.0.0/16 -d 10.244.0.0/24 -j RETURN
I0207 22:54:04.642681       1 ipmasq.go:85] Adding iptables rule: ! -s 10.244.0.0/16 -d 10.244.0.0/16 -j MASQUERADE
E0512 23:35:46.095482       1 reflector.go:304] github.com/coreos/flannel/subnet/kube/kube.go:284: Failed to watch *v1.Node: Get https://10.96.0.1:443/api/v1/nodes?resourceVersion=14065470&timeoutSeconds=376&watch=true: dial tcp 10.96.0.1:443: getsockopt: connection refused

